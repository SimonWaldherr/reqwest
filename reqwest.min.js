/*!
  * Reqwest! A general purpose XHR connection manager
  * (c) Dustin Diaz 2012
  * https://github.com/ded/reqwest
  * license MIT
  */
(function(e,t,n){"use strict";if(typeof module!=="undefined"&&module.exports){module.exports=n()}else if(typeof define==="function"&&define.amd){define(n)}else{t[e]=n()}})("reqwest",this,function(){"use strict";function handleReadyState(e,t,n){return function(){if(e._aborted){return n(e.request)}if(e.request&&e.request[readyState]===4){e.request.onreadystatechange=noop;if(twoHundo.test(e.request.status)){t(e.request)}else{n(e.request)}}}}function setHeaders(e,t){var n=t.headers||{},r;n.Accept=n.Accept||defaultHeaders.accept[t.type]||defaultHeaders.accept["*"];if(!t.crossOrigin&&!n[requestedWith])n[requestedWith]=defaultHeaders.requestedWith;if(!n[contentType])n[contentType]=t.contentType||defaultHeaders.contentType;for(r in n){n.hasOwnProperty(r);e.setRequestHeader(r,n[r])}}function setCredentials(e,t){if(typeof t.withCredentials!=="undefined"&&typeof e.withCredentials!=="undefined"){e.withCredentials=!!t.withCredentials}}function generalCallback(e){lastValue=e}function urlappend(e,t){return e+(/\?/.test(e)?"&":"?")+t}function handleJsonp(e,t,n,r){var i=uniqid++,s=e.jsonpCallback||"callback",o=e.jsonpCallbackName||reqwest.getcallbackPrefix(i),u=new RegExp("((^|\\?|&)"+s+")=([^&]+)"),a=r.match(u),f=doc.createElement("script"),l=0,c=navigator.userAgent.indexOf("MSIE 10.0")!==-1;if(a){if(a[3]==="?"){r=r.replace(u,"$1="+o)}else{o=a[3]}}else{r=urlappend(r,s+"="+o)}win[o]=generalCallback;f.type="text/javascript";f.src=r;f.async=true;if(typeof f.onreadystatechange!=="undefined"&&!c){f.event="onclick";f.htmlFor=f.id="_reqwest_"+i}f.onload=f.onreadystatechange=function(){if(f[readyState]&&f[readyState]!=="complete"&&f[readyState]!=="loaded"||l){return false}f.onload=f.onreadystatechange=null;f.onclick&&f.onclick();e.success&&e.success(lastValue);lastValue=undefined;head.removeChild(f);l=1};head.appendChild(f);return{abort:function(){f.onload=f.onreadystatechange=null;e.error&&e.error({},"Request is aborted: timeout",{});lastValue=undefined;head.removeChild(f);l=1}}}function getRequest(e,t){var n=this.o,r,i,s,o=(n.method||"GET").toUpperCase();if(typeof n==="string"){r=n}else{r=n.url}if(n.processData!==false&&n.data&&typeof n.data!=="string"){i=reqwest.toQueryString(n.data)}else{i=n.data||null}if((n.type==="jsonp"||o==="GET")&&i){r=urlappend(r,i);i=null}if(n.type==="jsonp"){return handleJsonp(n,e,t,r)}s=xhr();s.open(o,r,true);setHeaders(s,n);setCredentials(s,n);s.onreadystatechange=handleReadyState(this,e,t);n.before&&n.before(s);s.send(i);return s}function Reqwest(e,t){this.o=e;this.fn=t;init.apply(this,arguments)}function setType(e){var t=e.match(/\.(json|jsonp|html|xml)(\?|$)/);return t?t[1]:"js"}function init(o,fn){function complete(e){o.timeout&&clearTimeout(self.timeout);self.timeout=null;while(self._completeHandlers.length>0){self._completeHandlers.shift()(e)}}function success(resp){var r=resp.responseText;if(r){switch(type){case"json":try{resp=win.JSON?win.JSON.parse(r):eval("("+r+")")}catch(err){return error(resp,"Could not parse JSON in response",err)}break;case"js":resp=eval(r);break;case"html":resp=r;break;case"xml":resp=resp.responseXML&&resp.responseXML.parseError&&resp.responseXML.parseError.errorCode&&resp.responseXML.parseError.reason?null:resp.responseXML;break}}self._responseArgs.resp=resp;self._fulfilled=true;fn(resp);while(self._fulfillmentHandlers.length>0){self._fulfillmentHandlers.shift()(resp)}complete(resp)}function error(e,t,n){self._responseArgs.resp=e;self._responseArgs.msg=t;self._responseArgs.t=n;self._erred=true;while(self._errorHandlers.length>0){self._errorHandlers.shift()(e,t,n)}complete(e)}this.url=typeof o==="string"?o:o.url;this.timeout=null;this._fulfilled=false;this._fulfillmentHandlers=[];this._errorHandlers=[];this._completeHandlers=[];this._erred=false;this._responseArgs={};var self=this,type=o.type||setType(this.url);fn=fn||function(){};if(o.timeout){this.timeout=setTimeout(function(){self.abort()},o.timeout)}if(o.success){this._fulfillmentHandlers.push(function(){o.success.apply(o,arguments)})}if(o.error){this._errorHandlers.push(function(){o.error.apply(o,arguments)})}if(o.complete){this._completeHandlers.push(function(){o.complete.apply(o,arguments)})}this.request=getRequest.call(this,success,error)}function reqwest(e,t){return new Reqwest(e,t)}function normalize(e){return e?e.replace(/\r?\n/g,"\r\n"):""}function serial(e,t){var n=e.name,r=e.tagName.toLowerCase(),i=function(e){if(e&&!e.disabled)t(n,normalize(e.attributes.value&&e.attributes.value.specified?e.value:e.text))},s,o,u,a;if(e.disabled||!n)return;switch(r){case"input":if(!/reset|button|image|file/i.test(e.type)){s=/checkbox/i.test(e.type);o=/radio/i.test(e.type);u=e.value;(!(s||o)||e.checked)&&t(n,normalize(s&&u===""?"on":u))}break;case"textarea":t(n,normalize(e.value));break;case"select":if(e.type.toLowerCase()==="select-one"){i(e.selectedIndex>=0?e.options[e.selectedIndex]:null)}else{for(a=0;e.length&&a<e.length;a++){e.options[a].selected&&i(e.options[a])}}break}}function eachFormElement(){var e=this,t,n,r=function(t,n){var r,i,s;for(r=0;r<n.length;r++){s=t[byTag](n[r]);for(i=0;i<s.length;i++)serial(s[i],e)}};for(n=0;n<arguments.length;n++){t=arguments[n];if(/input|select|textarea/i.test(t.tagName))serial(t,e);r(t,["input","select","textarea"])}}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var e={};eachFormElement.apply(function(t,n){if(t in e){e[t]&&!isArray(e[t])&&(e[t]=[e[t]]);e[t].push(n)}else e[t]=n},arguments);return e}var win=window,doc=document,twoHundo=/^20\d$/,byTag="getElementsByTagName",readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",head=doc[byTag]("head")[0],uniqid=0,callbackPrefix="reqwest_"+ +(new Date),lastValue,xmlHttpRequest="XMLHttpRequest",isArray,defaultHeaders,xhr,noop=function(){};if(typeof Array.isArray==="function"){isArray=Array.isArray}else{isArray=function(e){return e instanceof Array}}defaultHeaders={contentType:"application/x-www-form-urlencoded",requestedWith:xmlHttpRequest,accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"}};if(win[xmlHttpRequest]){xhr=function(){return new XMLHttpRequest}}else{xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")}}Reqwest.prototype={abort:function(){this._aborted=true;this.request.abort()},retry:function(){init.call(this,this.o,this.fn)},then:function(e,t){if(this._fulfilled){e(this._responseArgs.resp)}else if(this._erred){t(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t)}else{this._fulfillmentHandlers.push(e);this._errorHandlers.push(t)}return this},always:function(e){if(this._fulfilled||this._erred){e(this._responseArgs.resp)}else{this._completeHandlers.push(e)}return this},fail:function(e){if(this._erred){e(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t)}else{this._errorHandlers.push(e)}return this}};reqwest.serializeArray=function(){var e=[];eachFormElement.apply(function(t,n){e.push({name:t,value:n})},arguments);return e};reqwest.serialize=function(){if(arguments.length===0)return"";var e,t,n=Array.prototype.slice.call(arguments,0);e=n.pop();e&&e.nodeType&&n.push(e)&&(e=null);e&&(e=e.type);if(e==="map")t=serializeHash;else if(e==="array")t=reqwest.serializeArray;else t=serializeQueryString;return t.apply(null,n)};reqwest.toQueryString=function(e){var t="",n,r=encodeURIComponent,i=function(e,n){t+=r(e)+"="+r(n)+"&"},s,o;if(isArray(e)){for(n=0;e&&n<e.length;n++)i(e[n].name,e[n].value)}else{for(s in e){if(!Object.hasOwnProperty.call(e,s))continue;o=e[s];if(isArray(o)){for(n=0;n<o.length;n++)i(s,o[n])}else i(s,e[s])}}return t.replace(/&$/,"").replace(/%20/g,"+")};reqwest.getcallbackPrefix=function(){return callbackPrefix};reqwest.compat=function(e,t){if(e){e.type&&(e.method=e.type)&&delete e.type;e.dataType&&(e.type=e.dataType);e.jsonpCallback&&(e.jsonpCallbackName=e.jsonpCallback)&&delete e.jsonpCallback;e.jsonp&&(e.jsonpCallback=e.jsonp)}return new Reqwest(e,t)};return reqwest})